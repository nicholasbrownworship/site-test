<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Characters - TTRPG Hub</title>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Cinzel+Decorative&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
  <link id="themeStylesheet" rel="stylesheet" href="highfantasy.css">
  <script src="theme-toggle.js" defer></script>
  <style>
    body { position: relative; }
    .pc-section { margin-bottom: 24px; }
    .pc-section h2 { margin-bottom: 12px; }

    #pcGridFantasy, #pcGridStarWars {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 12px;
    }

    .pc-card {
      background-color: rgba(212,175,55,0.15);
      color: #1b2e59;
      padding: 12px;
      border-radius: 10px;
      text-align: center;
      font-weight: 700;
      font-family: inherit;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .pc-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 6px 18px rgba(0,0,0,0.3);
    }

    .pc-card input, .pc-card textarea, .pc-card input[type=file], .pc-card button {
      display: block;
      width: 100%;
      margin-top: 6px;
      margin-bottom: 6px;
      padding: 6px;
      border-radius: 6px;
      border: 1px solid #1b2e59;
      font-family: inherit;
    }

    .pc-card button {
      background-color: #b22222;
      color: #fff;
      font-weight: 700;
      cursor: pointer;
      border: none;
    }

    .pc-card button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    button#addPCFantasy, button#addPCStarWars {
      margin-bottom: 12px;
      padding: 6px 10px;
      border-radius: 6px;
      border: none;
      background-color: #1b2e59;
      color: #d4af37;
      cursor: pointer;
      font-weight: bold;
    }

    button#addPCFantasy:hover, button#addPCStarWars:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    /* Dice Widget Styles */
    #diceWidget {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: rgba(212,175,55,0.95);
      color: #1b2e59;
      padding: 12px;
      border-radius: 10px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.3);
      font-family: inherit;
      width: 200px;
      z-index: 1000;
    }

    #diceWidget h3 { margin-top: 0; text-align: center; }
    #diceWidget select, #diceWidget input, #diceWidget button {
      width: 100%;
      margin-top: 6px;
      margin-bottom: 6px;
      padding: 6px;
      border-radius: 6px;
      border: 1px solid #1b2e59;
      font-family: inherit;
    }

    #diceWidget button {
      background-color: #1b2e59;
      color: #d4af37;
      font-weight: bold;
      cursor: pointer;
    }

    #diceWidget button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    #diceResult { text-align: center; margin-top: 6px; font-weight: bold; }
    #diceHistory {
      list-style: none;
      padding-left: 0;
      max-height: 100px;
      overflow-y: auto;
      margin-top: 6px;
      font-size: 0.9em;
    }
    #diceHistory li { padding: 2px 4px; border-bottom: 1px solid rgba(27,46,89,0.3); }
  </style>
</head>
<body>
  <header>
    <div>
      <h1>Characters</h1>
      <nav aria-label="Main">
        <a href="index.html">Home</a>
        <a href="campaign.html">Campaign</a>
        <a href="characters.html">Characters</a>
        <a href="calendar.html">Calendar</a>
        <a href="resources.html">Resources</a>
        <a href="forum.html">Forum</a>
      </nav>
    </div>
    <div>
      <button id="toggleTheme" aria-pressed="false">Toggle Theme</button>
    </div>
  </header>

  <main>
    <section class="card pc-section">
      <h2>High Fantasy / D&D Characters</h2>
      <button id="addPCFantasy">New PC</button>
      <div id="pcGridFantasy"></div>
    </section>

    <section class="card pc-section">
      <h2>Star Wars / Sci-Fi Characters</h2>
      <button id="addPCStarWars">New PC</button>
      <div id="pcGridStarWars"></div>
    </section>
  </main>

  <!-- Dice Roller Widget -->
  <div id="diceWidget">
    <h3>Dice Roller</h3>
    <label for="diceType">Dice:</label>
    <select id="diceType">
      <option value="4">d4</option>
      <option value="6" selected>d6</option>
      <option value="8">d8</option>
      <option value="10">d10</option>
      <option value="12">d12</option>
      <option value="20">d20</option>
    </select>
    <label for="diceCount">Count:</label>
    <input type="number" id="diceCount" value="1" min="1" max="10">
    <button id="rollDice">Roll</button>
    <div id="diceResult">Result: -</div>
    <h4>Recent Rolls</h4>
    <ul id="diceHistory"></ul>
  </div>

  <script>
    // Character Handling
    document.addEventListener("DOMContentLoaded", () => {
      const pcGridFantasy = document.getElementById("pcGridFantasy");
      const addPCFantasy = document.getElementById("addPCFantasy");
      const pcGridStarWars = document.getElementById("pcGridStarWars");
      const addPCStarWars = document.getElementById("addPCStarWars");

      const savedFantasy = JSON.parse(localStorage.getItem("pcsFantasy") || "[]");
      savedFantasy.forEach(pc => addPCCard(pc, pcGridFantasy));

      const savedStarWars = JSON.parse(localStorage.getItem("pcsStarWars") || "[]");
      savedStarWars.forEach(pc => addPCCard(pc, pcGridStarWars));

      addPCFantasy.addEventListener("click", () => addPCCard({}, pcGridFantasy));
      addPCStarWars.addEventListener("click", () => addPCCard({}, pcGridStarWars));

      function addPCCard(data = {}, grid) {
        const card = document.createElement("div");
        card.className = "pc-card";

        const nameInput = document.createElement("input");
        nameInput.type = "text";
        nameInput.placeholder = "Character Name";
        nameInput.value = data.name || "";
        nameInput.addEventListener("input", savePCs);

        const backstoryInput = document.createElement("textarea");
        backstoryInput.placeholder = "Optional backstory...";
        backstoryInput.value = data.backstory || "";
        backstoryInput.addEventListener("input", savePCs);

        const img = document.createElement("img");
        img.src = data.image || "character-placeholder.jpg";
        img.style.maxWidth = "100%";
        img.style.borderRadius = "6px";
        img.style.border = "3px solid rgba(212,175,55,0.14)";

        const fileInput = document.createElement("input");
        fileInput.type = "file";
        fileInput.accept = "image/*";
        fileInput.addEventListener("change", (e) => {
          const file = e.target.files[0];
          if(file) {
            const reader = new FileReader();
            reader.onload = (event) => {
              img.src = event.target.result;
              savePCs();
            };
            reader.readAsDataURL(file);
          }
        });

        const deleteBtn = document.createElement("button");
        deleteBtn.textContent = "Delete PC";
        deleteBtn.addEventListener("click", () => {
          if(confirm("Are you sure you want to delete this PC?")) {
            card.remove();
            savePCs();
          }
        });

        card.appendChild(img);
        card.appendChild(nameInput);
        card.appendChild(backstoryInput);
        card.appendChild(fileInput);
        card.appendChild(deleteBtn);

        grid.appendChild(card);
        savePCs();
      }

      function savePCs() {
        const pcsFantasy = [];
        pcGridFantasy.querySelectorAll(".pc-card").forEach(card => {
          const name = card.querySelector("input[type=text]").value;
          const backstory = card.querySelector("textarea").value;
          const image = card.querySelector("img").src;
          pcsFantasy.push({name, backstory, image});
        });
        localStorage.setItem("pcsFantasy", JSON.stringify(pcsFantasy));

        const pcsStarWars = [];
        pcGridStarWars.querySelectorAll(".pc-card").forEach(card => {
          const name = card.querySelector("input[type=text]").value;
          const backstory = card.querySelector("textarea").value;
          const image = card.querySelector("img").src;
          pcsStarWars.push({name, backstory, image});
        });
        localStorage.setItem("pcsStarWars", JSON.stringify(pcsStarWars));
      }
    });

    // Dice Roller with History
    document.addEventListener("DOMContentLoaded", () => {
      const rollBtn = document.getElementById("rollDice");
      const diceType = document.getElementById("diceType");
      const diceCount = document.getElementById("diceCount");
      const diceResult = document.getElementById("diceResult");
      const diceHistory = document.getElementById("diceHistory");

      const maxHistory = 5;

      rollBtn.addEventListener("click", () => {
        const sides = parseInt(diceType.value);
        const count = parseInt(diceCount.value);
        if (!sides || !count) return;

        let rolls = [];
        for (let i = 0; i < count; i++) {
          rolls.push(Math.floor(Math.random() * sides) + 1);
        }

        const total = rolls.reduce((a, b) => a + b, 0);
        diceResult.textContent = `Result: ${rolls.join(", ")} (Total: ${total})`;

        const historyItem = document.createElement("li");
        historyItem.textContent = `${count}d${sides}: ${rolls.join(", ")} (Total: ${total})`;
        diceHistory.prepend(historyItem);

        while(diceHistory.children.length > maxHistory) {
          diceHistory.removeChild(diceHistory.lastChild);
        }
      });
    });
  </script>
</body>
</html>
